# 运营活动的测试 Tips


## 1. 除活动持续时间外，活动一定不能生效

* “双倍经验/烈火币” 活动时间为 2019-01-01 8:00:00 ~ 2019-01-02 23:59:59，那么，2019-01-01 7:00:00 和 2019-01-03 00:01:00 两个时间点一定不能获得双倍加成

* “周免球员” 活动时间为 2019-01-01 8:00:00 ~ 2019-01-02 23:59:59，那么，2019-01-01 7:00:00 和 2019-01-03 00:01:00 两个时间点，“活动” icon 上一定不能出现 “周免球员” 活动产生的红点提示


## 2. 活动详情的准确性 / 合理性

* “累计登录” 的活动详情中提到奖励为潜能材料，而下方的奖励列表为徽章碎片（杜绝！）

* 详情的描述需要合情合理，与具体的活动内容相符。若活动出现新内容，则详情需要实时更新


## 3. 客户端配表和服务器配表必须一致

* 不能出现客户端显示的奖励和服务器实际下发的奖励不一致的情况

    * “累计登录” 的某一天奖励显示为 100 钻石，则领取的时候，实际获得的必须是 100 钻石，不能是 200 钻石

* 如果出现需要更改线上活动奖励的情况，推荐的做法是：先更新**服务器**，再更新**客户端**


## 4. 活动时间不受玩家的设备时间影响

* 玩家更改设备的时间，不能影响活动的正常运行 (活动需完全依靠服务器时间)

    * 若当前服务器时间的活动已关闭，则玩家更改设备时间至活动开启时间，活动仍需处于关闭状态


## 5. 玩家活动数据的初始化时机

* 有些活动必须进入活动界面才能完成任务，有些活动则不需要进入活动页面就能完成任务。

* 一般情况下，玩家第一次进入活动界面时，服务器会初始化一次活动进度数据。之后，玩家完成一个任务时，就会在初始化之后的数据上进行操作

* 然而，如果活动开启后，玩家不进入活动界面，直接完成任务，那么 **更新玩家进度之前，必须要有初始化活动数据的操作**，否则可能会造成玩家数据错乱的情况

    * “九宫格” 活动中有若干任务，活动开启后，若玩家不打开活动界面，直接完成任务，其活动数据(Redis数据)必须正确。


## 6. 活动复用

* 需要多次开启的活动必须保证复用的正确性 (第一次功能测试时就应该测试，提高下次复用时的测试效率)

* 活动复用一般只涉及服务器逻辑，很少涉及客户端逻辑 (目前暂未发现客户端导致的复用 Bug)

* 检查复用的正确性 --------> 检查本次活动的玩家数据对下次活动复用时的影响

* 一般情况下，玩家的活动数据中会专门记录一个时间戳，用来表示本次的活动的开始时间。服务器通过比较 **当前记录的时间戳** 和 **当前配置的活动开始时间** ，决定是否重置玩家活动数据，并更新时间戳 (重置 即 表示新的活动已开启)

* 活动的开启是由 **客户端配表 + 服务器配表** 共同决定的。通常情况下，策划只会配置第一次的活动时间，然后 QA 将本地服务器时间调至活动时间，并开展测试工作。但是想要活动第二次开启的话，就需要策划重新配置活动时间。在 Unity 环境中，两个配表可以随意更改。但是在 .apk 或是 .ipa 中，客户端配表是很难更改的，这时该如何 **快速** 地测试复用的正确性呢？

    * 改变思路，从 **检查本次活动的玩家数据对下次活动复用时的影响** 变成 **检查上次活动的玩家数据对本次活动复用时的影响**

    * 既然已经有了本次活动的的数据，那么将活动数据中的时间戳改成活动开始时间之前的任意值，然后重新登录即可检查活动复用的正确性 (这就省去了更改配表的步骤)

* 对于需要复用的活动，需要注意 **活动结束后，玩家的活动数据是否会更新**

    * 通常情况下，在下次活动开启之前，该数据会不再更新

    * 如果在下次活动开启之前，该数据会被更新，则需要验证这种更新是否会对下次活动产生影响 (具体影响视具体的活动逻辑而定)


## 7. 活动优化

* 活动优化一般分两种（具体是哪一种，可以问程序，也可以自行检查代码）

    * 纯逻辑优化：玩家的活动数据不变，只改变代码的执行逻辑

    * 数据存储结构优化：多为较大的功能优化，会增加/减少玩家活动数据中的字段

* 对于数据存储结构优化，要着重测试 **该优化对于老玩家的影响**，即 **优化是否兼容原先的活动数据**

* 测试方式：通过手动更改 Redis 数据库，人为制造一些老数据，然后重新登录，检查优化后的表现

## 8. Coming Soon...